<template>
    <!-- Modern Dealer Analytics Component -->
    <div class="dealer-analytics-container">
        <div class="header-section">
            <div class="header-content">
                <div class="title-group">
                    <div class="header-icon">
                        <lightning-icon icon-name="standard:account" size="medium"></lightning-icon>
                    </div>
                    <h2 class="main-title">Dealer Detail</h2>
                </div>
            </div>
            <div class="info-banner">
                <div class="info-icon">
                    <lightning-icon icon-name="utility:info" size="x-small"></lightning-icon>
                </div>
                <p class="info-text">Search and analyze dealer performance metrics</p>
            </div>
        </div>

        <div class="content-section">
        <!-- Loading State -->
        <template if:true={isLoading}>
            <div class="loading-container">
                <lightning-spinner size="medium" alternative-text="Loading dealer data..."></lightning-spinner>
                <p class="loading-text">Loading dealer performance data...</p>
            </div>
        </template>

        <!-- Error State -->
        <template if:true={error}>
            <div class="error-container">
                <lightning-icon icon-name="utility:error" size="small" class="error-icon"></lightning-icon>
                <span class="error-text">{error}</span>
            </div>
        </template>

        <!-- Empty State -->
        <template if:false={hasSelectedDealer}>
            <template if:false={isLoading}>
                <template if:false={error}>
                    <!-- Header with Search for Empty State -->
                    <div class="dealer-header empty-header">
                        <div class="dealer-info">
                            <lightning-icon icon-name="standard:account" size="large" class="dealer-icon"></lightning-icon>
                            <div class="dealer-details">
                                <h1 class="dealer-name">Dealer Analytics</h1>
                                <div class="dealer-subtitle">Select a dealer to view performance metrics</div>
                            </div>
                        </div>
                        <!-- Search in Header -->
                        <div class="header-search-container">
                            <lightning-input
                                type="search"
                                placeholder="Search dealer by name or region..."
                                value={searchTerm}
                                onchange={handleSearchInput}
                                onfocus={handleInputFocus}
                                onblur={handleInputBlur}
                                class="dealer-search header-search"
                                variant="label-hidden">
                            </lightning-input>
                            
                            <!-- Search Results Dropdown -->
                            <template if:true={showResults}>
                                <div class="search-dropdown">
                                    <template for:each={searchResults} for:item="dealer">
                                        <div key={dealer.id} 
                                             onclick={handleDealerSelect} 
                                             data-dealer-id={dealer.id}
                                             class="search-result-item">
                                            <div class="dealer-result-name">{dealer.name}</div>
                                            <div class="dealer-result-region">{dealer.region}</div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="empty-state">
                        <lightning-icon icon-name="utility:search" size="large" class="empty-icon"></lightning-icon>
                        <h2 class="empty-title">Select a Dealer</h2>
                        <p class="empty-description">Search and select a dealer above to view detailed analytics and performance metrics</p>
                        <div class="feature-badges">
                            <lightning-badge label="Real-time Data" variant="lightest"></lightning-badge>
                            <lightning-badge label="Performance Metrics" variant="lightest"></lightning-badge>
                            <lightning-badge label="Trend Analysis" variant="lightest"></lightning-badge>
                        </div>
                    </div>
                </template>
            </template>
        </template>

        <!-- Main Dealer Content -->
        <template if:true={hasSelectedDealer}>
            <div class="dealer-content">
                
                <!-- Dealer Header with Integrated Search -->
                <div class="dealer-header">
                    <div class="dealer-info">
                        <lightning-icon icon-name="standard:account" size="large" class="dealer-icon"></lightning-icon>
                        <div class="dealer-details">
                            <h1 class="dealer-name">{selectedDealer.name}</h1>
                            <div class="dealer-badges">
                                <lightning-badge label={selectedDealer.region} class="region-badge"></lightning-badge>
                                <lightning-badge label="Active" variant="success" class="status-badge"></lightning-badge>
                            </div>
                        </div>
                    </div>
                    <!-- Search in Header -->
                    <div class="header-search-container">
                        <lightning-input
                            type="search"
                            placeholder="Search dealer by name or region..."
                            value={searchTerm}
                            onchange={handleSearchInput}
                            onfocus={handleInputFocus}
                            onblur={handleInputBlur}
                            class="dealer-search header-search"
                            variant="label-hidden">
                        </lightning-input>
                        
                        <!-- Search Results Dropdown -->
                        <template if:true={showResults}>
                            <div class="search-dropdown">
                                <template for:each={searchResults} for:item="dealer">
                                    <div key={dealer.id} 
                                         onclick={handleDealerSelect} 
                                         data-dealer-id={dealer.id}
                                         class="search-result-item">
                                        <div class="dealer-result-name">{dealer.name}</div>
                                        <div class="dealer-result-region">{dealer.region}</div>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Key Metrics Grid -->
                <div class="metrics-grid">
                    <!-- Amount Financed This Month -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <lightning-icon icon-name="utility:currency" size="small" class="metric-icon"></lightning-icon>
                            <span class="metric-label">Amount Financed This Month</span>
                        </div>
                        <div class="metric-value">{selectedDealer.monthlyAmountFinanced}</div>
                    </div>

                    <!-- Average Deal Size -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <lightning-icon icon-name="utility:chart" size="small" class="metric-icon"></lightning-icon>
                            <span class="metric-label">Average Deal Size</span>
                        </div>
                        <div class="metric-value">{selectedDealer.averageDealSize}</div>
                    </div>

                    <!-- Deals This Month -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <lightning-icon icon-name="utility:number_input" size="small" class="metric-icon"></lightning-icon>
                            <span class="metric-label">Deals This Month</span>
                        </div>
                        <div class="metric-value">{selectedDealer.monthlyDeals}</div>
                    </div>

                    <!-- Last Month Amount -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <lightning-icon icon-name="utility:date_time" size="small" class="metric-icon"></lightning-icon>
                            <span class="metric-label">Last Month Amount</span>
                        </div>
                        <div class="metric-value">{selectedDealer.lastMonthAmountFinanced}</div>
                    </div>
                </div>

                <!-- Performance Chart Section -->
                <div class="chart-section">
                    <div class="chart-header">
                        <div class="chart-title-area">
                            <lightning-icon icon-name="utility:chart" size="small" class="chart-icon"></lightning-icon>
                            <h2 class="chart-title">Performance Trends</h2>
                        </div>
                        <div class="chart-controls">
                            <lightning-combobox
                                value={selectedLookbackPeriod}
                                placeholder="Select Period"
                                options={lookbackPeriodOptions}
                                onchange={handleLookbackPeriodChange}
                                class="period-selector"
                                variant="label-hidden">
                            </lightning-combobox>
                        </div>
                    </div>
                    
                  

                    <!-- Chart Container -->
                    <div class="chart-container">
                        <template if:true={isChartLoading}>
                            <div class="chart-loading">
                                <lightning-spinner size="small" alternative-text="Loading chart..."></lightning-spinner>
                                <p class="chart-loading-text">Loading chart data...</p>
                            </div>
                        </template>
                        
                        <template if:false={isChartLoading}>
                            <canvas class="chart-canvas"></canvas>
                        </template>
                    </div>
                </div>

            </div>
        </template>
        </div>
    </div>
</template>