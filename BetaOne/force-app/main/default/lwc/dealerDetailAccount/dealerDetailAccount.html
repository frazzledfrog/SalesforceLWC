<template>
    <!-- Modern Dealer Analytics Component -->
    <div class="dealer-analytics-container">

        <!-- Loading State -->
        <template if:true={isLoading}>
            <div class="loading-container">
                <lightning-spinner size="medium" alternative-text="Loading dealer data..."></lightning-spinner>
                <p class="loading-text">Loading dealer performance data...</p>
            </div>
        </template>

        <!-- Error State -->
        <template if:true={error}>
            <div class="error-container">
                <lightning-icon icon-name="utility:error" size="small" class="error-icon"></lightning-icon>
                <span class="error-text">{error}</span>
            </div>
        </template>

        <!-- Empty State -->
        <template if:false={hasDealer}>
            <template if:false={isLoading}>
                <template if:false={error}>
                    <div class="empty-state">
                        <lightning-icon icon-name="utility:search" size="large" class="empty-icon"></lightning-icon>
                        <h2 class="empty-title">No Dealer Selected</h2>
                        <p class="empty-description">No dealer data available for this account.</p>
                        <div class="feature-badges">
                            <lightning-badge label="Real-time Data" variant="lightest"></lightning-badge>
                            <lightning-badge label="Performance Metrics" variant="lightest"></lightning-badge>
                            <lightning-badge label="Trend Analysis" variant="lightest"></lightning-badge>
                        </div>
                    </div>
                </template>
            </template>
        </template>

        <!-- Main Dealer Content -->
        <template if:true={hasDealer}>
            <div class="dealer-content">

                <!-- Key Metrics Grid -->
                <div class="metrics-grid">
                    <!-- Amount Financed This Month -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <lightning-icon icon-name="utility:currency" size="small" class="metric-icon"></lightning-icon>
                            <span class="metric-label">Amount Financed This Month</span>
                        </div>
                        <div class="metric-value">{selectedDealer.monthlyAmountFinanced}</div>
                    </div>

                    <!-- Average Deal Size -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <lightning-icon icon-name="utility:chart" size="small" class="metric-icon"></lightning-icon>
                            <span class="metric-label">Average Deal Size</span>
                        </div>
                        <div class="metric-value">{selectedDealer.averageDealSize}</div>
                    </div>

                    <!-- Deals This Month -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <lightning-icon icon-name="utility:number_input" size="small" class="metric-icon"></lightning-icon>
                            <span class="metric-label">Deals This Month</span>
                        </div>
                        <div class="metric-value">{selectedDealer.monthlyDeals}</div>
                    </div>

                    <!-- Last Month Amount -->
                    <div class="metric-card">
                        <div class="metric-header">
                            <lightning-icon icon-name="utility:date_time" size="small" class="metric-icon"></lightning-icon>
                            <span class="metric-label">Last Month Amount</span>
                        </div>
                        <div class="metric-value">{selectedDealer.lastMonthAmountFinanced}</div>
                    </div>
                </div>

                <!-- Performance Chart Section -->
                <div class="chart-section">
                    <div class="chart-header">
                        <div class="chart-title-area">
                            <lightning-icon icon-name="utility:chart" size="small" class="chart-icon"></lightning-icon>
                            <h2 class="chart-title">Performance Trends</h2>
                        </div>
                        <div class="chart-controls">
                            <lightning-combobox
                                value={selectedLookbackPeriod}
                                placeholder="Select Period"
                                options={lookbackPeriodOptions}
                                onchange={handleLookbackPeriodChange}
                                class="period-selector"
                                variant="label-hidden">
                            </lightning-combobox>
                        </div>
                    </div>
                    
                  

                    <!-- Chart Container -->
                    <div class="chart-container">
                        <template if:true={isChartLoading}>
                            <div class="chart-loading">
                                <lightning-spinner size="small" alternative-text="Loading chart..."></lightning-spinner>
                                <p class="chart-loading-text">Loading chart data...</p>
                            </div>
                        </template>
                        
                        <!-- Canvas is always present but hidden when loading -->
                        <canvas class="chart-canvas" style={chartCanvasStyle}></canvas>
                    </div>
                </div>

            </div>
        </template>
    </div>
</template>